

<!DOCTYPE html>
<html lang="en">
  <head>
                    <script type="text/javascript">
        var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
        document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
        </script>
        <script type="text/javascript">
        try {
          var pageTracker = _gat._getTracker("UA-40920108-1");
          pageTracker._trackPageview();
        } catch(err) {}
        </script>
                <link href='http://fonts.googleapis.com/css?family=Open+Sans|Merriweather' rel='stylesheet' type='text/css' />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title> jasonpbecker </title>

    <link rel="stylesheet" href="./theme/css/style.css" type="text/css" />
    <link rel="stylesheet" href="./theme/css/pygments.css" type="text/css" />
    <link rel="stylesheet" href="./theme/css/font-awesome.css" type="text/css"/>
      </head>
  <body>
    <div class=container>
                    
      <div class=navigation>
        <ul>
                      <li><a href="./index.html">Blog</a> </li>
                      <li><a href="./about.html">About</a> </li>
                      <li><a href="./archives.html">Archive</a> </li>
                  </ul>
      </div>
      <div class=separator></div>                
        <div class=body>
        
            <h1 class="title">Calculating Age in R<a href="./2013/06/calculating-age-in-r.html" class=perma>&#8734;</a></h1>
      <p class=date> 2013-06-12 </p>
      <p>A few months back I wrote some code to calculate age from a date of birth and arbitrary end date. It is not a real tricky task, but it is certainly one that comes up often when doing research on individual-level data.</p>
<p>I was a bit surprised to only find bits and pieces of code and advice on how to best go about this task. After reading through some old R-help and Stack Overflow responses on various ways to do date math in R, this is the function I wrote <sup id="fnref:wrote"><a class="footnote-ref" href="#fn:wrote" rel="footnote">1</a></sup>:</p>
<div class="highlight"><pre>age_calc <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span>dob<span class="p">,</span> enddate<span class="o">=</span>Sys.Date<span class="p">(),</span> units<span class="o">=</span><span class="s">&#39;months&#39;</span><span class="p">){</span>
  <span class="kr">if</span> <span class="p">(</span><span class="o">!</span>inherits<span class="p">(</span>dob<span class="p">,</span> <span class="s">&quot;Date&quot;</span><span class="p">)</span> <span class="o">|</span> <span class="o">!</span>inherits<span class="p">(</span>enddate<span class="p">,</span> <span class="s">&quot;Date&quot;</span><span class="p">))</span>
    stop<span class="p">(</span><span class="s">&quot;Both dob and enddate must be Date class objects&quot;</span><span class="p">)</span>
  start <span class="o">&lt;-</span> as.POSIXlt<span class="p">(</span>dob<span class="p">)</span>
  end <span class="o">&lt;-</span> as.POSIXlt<span class="p">(</span>enddate<span class="p">)</span>

  years <span class="o">&lt;-</span> end<span class="o">$</span>year <span class="o">-</span> start<span class="o">$</span>year
  <span class="kr">if</span><span class="p">(</span>units<span class="o">==</span><span class="s">&#39;years&#39;</span><span class="p">){</span>
    result <span class="o">&lt;-</span> ifelse<span class="p">((</span>end<span class="o">$</span>mon <span class="o">&lt;</span> start<span class="o">$</span>mon<span class="p">)</span> <span class="o">|</span> 
                      <span class="p">((</span>end<span class="o">$</span>mon <span class="o">==</span> start<span class="o">$</span>mon<span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span>end<span class="o">$</span>mday <span class="o">&lt;</span> start<span class="o">$</span>mday<span class="p">)),</span>
                      years <span class="o">-</span> <span class="m">1</span><span class="p">,</span> years<span class="p">)</span>    
  <span class="p">}</span><span class="kr">else</span> <span class="kr">if</span><span class="p">(</span>units<span class="o">==</span><span class="s">&#39;months&#39;</span><span class="p">){</span>
    months <span class="o">&lt;-</span> <span class="p">(</span>years<span class="m">-1</span><span class="p">)</span> <span class="o">*</span> <span class="m">12</span>
    result <span class="o">&lt;-</span> months <span class="o">+</span> start<span class="o">$</span>mon
  <span class="p">}</span><span class="kr">else</span> <span class="kr">if</span><span class="p">(</span>units<span class="o">==</span><span class="s">&#39;days&#39;</span><span class="p">){</span>
    result <span class="o">&lt;-</span> difftime<span class="p">(</span>end<span class="p">,</span> start<span class="p">,</span> units<span class="o">=</span><span class="s">&#39;days&#39;</span><span class="p">)</span>
  <span class="p">}</span><span class="kr">else</span><span class="p">{</span>
    stop<span class="p">(</span><span class="s">&quot;Unrecognized units. Please choose years, months, or days.&quot;</span><span class="p">)</span>
  <span class="p">}</span>
  <span class="kr">return</span><span class="p">(</span>result<span class="p">)</span>
<span class="p">}</span>
</pre></div>


<p>A few notes on proper usage and the choices I made in writing this function: </p>
<ul>
<li>The parameters <code>dob</code> and <code>enddate</code> expect data that is already in one of the various classes that minimally inherits the base class <code>Date</code>. </li>
<li>This function takes advantage of the way that R treats vectors, so both <code>dob</code> and <code>enddate</code> can be a single or multi-element vector. For example <code>enddate</code> is a single date, as is the default, then the function will return a vector that calculates the difference between <code>dob</code> and that single date for each element in <code>dob</code>. If <code>dob</code> and <code>enddate</code> are both vectors with n&gt;1, then the returned vector will contain the <a href="http://heather.cs.ucdavis.edu/~matloff/r.old.html#elementwise">element-wise</a> difference between <code>dob</code> and <code>enddate</code>. When the vectors are of different sizes, the shorter vector will be repeated over until it reaches the same length as the longer vector. This is known as <a href="http://cran.r-project.org/doc/manuals/R-intro.html#The-recycling-rule">recycling</a>, and it is the default behavior in R.</li>
<li>This function always returns an integer. Calculating age in years will never return, say, 26.2. Instead, it assumes that the correct behavior for age calculations is something like a <code>floor</code> function. For examle, the function will only return 27 if <code>enddate</code> is minimally your 27th birthday. Up until that day you are considered 26. The same is true for age in months.</li>
</ul>
<p>This is probably the first custom function in almost 3 years using R that I wrote to be truly generalizable. I was inspired by three factors. First, this is a truly frequent task that I will have to apply to many data sets in the future that I don't want to have to revisit. Second, a professional acquaintance, <a href="http://jaredknowles.com/">Jared Knowles</a>, is putting together a CRAN package with various convenience functions for folks who are new to R and using it to analyze education data <sup id="fnref:eeptools"><a class="footnote-ref" href="#fn:eeptools" rel="footnote">2</a></sup>. This seemed like an appropriate addition to that package, so I wanted to write it to that standard. In fact, it was my first (and to date, only) submitted and accepted pull request on Github. Third, it is a tiny, simple function so it was easy to wrap my head around and write it well. I will let you be the judge of my success or failure <sup id="fnref:inspiration"><a class="footnote-ref" href="#fn:inspiration" rel="footnote">3</a></sup>.</p>
<div class="footnote">
<hr />
<ol>
<li id="fn:wrote">
<p>I originally used <code>Sys.time()</code> not realizing there was a <code>Sys.Date()</code> function. Thanks to Jared Knowles for that edit in preparation for a CRAN check.&#160;<a class="footnote-backref" href="#fnref:wrote" rev="footnote" title="Jump back to footnote 1 in the text">&#8617;</a></p>
</li>
<li id="fn:eeptools">
<p>Check out <a href="https://github.com/jknowles/eeptools">eeptools</a> on Github.&#160;<a class="footnote-backref" href="#fnref:eeptools" rev="footnote" title="Jump back to footnote 2 in the text">&#8617;</a></p>
</li>
<li id="fn:inspiration">
<p>Thanks to <a href="http://mcfromnz.wordpress.com/2013/06/12/updated-age-calculation-function/">Matt's Stats n Stuff</a> for getting me to write this post. When I saw another age calculation function pop up on the r-bloggers feed I immediately thought of this function. Matt pointed out that it was quite hard to Google for age calculations in R, lamenting that Google doesn't meaningfully crawl Github where I linked to find my code. So this post is mostly about providing some help to less experience R folks who are frantically Googling as both Matt and I did when faced with this need.&#160;<a class="footnote-backref" href="#fnref:inspiration" rev="footnote" title="Jump back to footnote 3 in the text">&#8617;</a></p>
</li>
</ol>
</div>
      
                      <div class=entry-overview>
        <div class=date>Jun 02, 2013</div>
        <div class=detail>
          <h1><a href="./2013/06/linear-thinking.html">Linear Thinking</a></h1>
            <div class=summary><p><p>Apple will be revealing new details for both of its major operating systems at WWDC on June 10, 2013. The focus of much speculation has been how Apple will improve multi-tasking and inter-app communication in iOS7. As batteries have grown, CPUs have become increasingly powerful, and the application <a href="./2012/11/frictionless.html">ecosystem</a> has ...</p></p></div>
        </div>
      </div>
                <div class=entry-overview>
        <div class=date>May 30, 2013</div>
        <div class=detail>
          <h1><a href="./2013/05/cleaning-urls-with-textexpander.html">Cleaning URLs with TextExpander</a></h1>
            <div class=summary><p><p>One thing I really dislike about Google Reader is it replaces the links to posts in my RSS feed. My <a href="http://pinboard.in/u:jasonpbecker">Pinboard account</a> is littered with links that start with <code>http://feedproxy.google.com</code>. I am quite concerned that with the demise of <a href="http://googlereader.blogspot.com/2013/03/powering-down-google-reader.html">Google Reader</a> on July 1, 2013, these redirects ...</p></p></div>
        </div>
      </div>
                <div class=entry-overview>
        <div class=date>Dec 20, 2012</div>
        <div class=detail>
          <h1><a href="./2012/12/the-slow-trek-to-pelican.html">The Slow Trek to Pelican</a></h1>
            <div class=summary><p><p><em>Update: Please see below for two solutions.</em></p>
<p>I have grown increasingly unhappy with Wordpress lately. My blog is simple. My design tastes are simple. My needs are simple. I like control. I am a geek. And I really need an excuse to learn Python, which seems to be rapidly growing ...</p></p></div>
        </div>
      </div>
                <div class=entry-overview>
        <div class=date>Nov 20, 2012</div>
        <div class=detail>
          <h1><a href="./2012/11/a-little-knowledge-is-a-wonderful-dangerous-thing.html">A little knowledge is a wonderful (dangerous) thing</a></h1>
            <div class=summary><p><p>Applying the lessons of cognitive science to education is not a straight forward task. Even with the best intentions, we may do more harm than good.</p>
<div class="footnote">
<hr />
<ol>
<li id="fn:1">
<p>E.D. Hirsch's term&#160;<a class="footnote-backref" href="#fnref:1" rev="footnote" title="Jump back to footnote 1 in the text">&#8617;</a></p>
</li>
<li id="fn:2">
<p>In the area of neuroscience and cognitive science, I am probably only marginally better off than most teachers. My Sc.B. is in chemistry. So a background in empirical physical sciences and my knowledge of social science may help me to access some of the research on how people learn, but I would probably be just as susceptible to overconfidence in my ability to process this research and repeat untruths as many very intelligent educators.&#160;<a class="footnote-backref" href="#fnref:2" rev="footnote" title="Jump back to footnote 2 in the text">&#8617;</a></p>
</li>
</ol>
</div></p></div>
        </div>
      </div>
                <div class=entry-overview>
        <div class=date>Nov 04, 2012</div>
        <div class=detail>
          <h1><a href="./2012/11/frictionless.html">Frictionless</a></h1>
            <div class=summary><p><p>The key benefit that Apple has is <em>ecosystem</em>. Catching up with high quality hardware is just not enough.</p>
<div class="footnote">
<hr />
<ol>
<li id="fn:hardware">
<p>Hardly a given in the past from either Google (LG/ASUS) and Microsoft partners. Although Microsoft's actual hardware, until now primarily keyboards and mice (do you pluralize a computer mouse? It seems strange.)&#160;<a class="footnote-backref" href="#fnref:hardware" rev="footnote" title="Jump back to footnote 1 in the text">&#8617;</a></p>
</li>
<li id="fn:toolate">
<p>I really think it might be. Windows Phone 7 was brilliant, but released 2 years too late behind at least 1 year of development.&#160;<a class="footnote-backref" href="#fnref:toolate" rev="footnote" title="Jump back to footnote 2 in the text">&#8617;</a></p>
</li>
</ol>
</div></p></div>
        </div>
      </div>
                <div class=entry-overview>
        <div class=date>Nov 02, 2012</div>
        <div class=detail>
          <h1><a href="./2012/11/paul-cuffee-middle-school-addressing-emotional-needs.html">Paul Cuffee Middle School, Addressing Emotional Needs</a></h1>
            <div class=summary><p><p>I like this piece in Slate on <a href="http://www.paulcuffee.org">Paul Cuffee Middle School</a>, a charter school right here in Providence. Most of what I know about child development seems to suggest that middle schools are sort of ridiculous. At the moment children are looking for role models and close relationships with adults ...</p></p></div>
        </div>
      </div>
                <div class=entry-overview>
        <div class=date>Oct 09, 2012</div>
        <div class=detail>
          <h1><a href="./2012/10/where-i-share.html">Where I Share</a></h1>
            <div class=summary><p><p>I have been meaning to write this post for the past couple of weeks. Like most other people, I am constantly experimenting with different ways to publish and share my thoughts and engage with social networking. Lately, I have settled into what feels like an "end state" workflow<sup id="fnref:1"><a class="footnote-ref" href="#fn:1" rel="footnote">1</a></sup>. I ...</p></p></div>
        </div>
      </div>
                <div class=entry-overview>
        <div class=date>Oct 01, 2012</div>
        <div class=detail>
          <h1><a href="./2012/10/what-can-management-do-ios6-maps-monday-morning-quarterbacking.html">What Can Management Do? iOS6 Maps Monday-Morning Quarterbacking</a></h1>
            <div class=summary><p><p><a href="https://twitter.com/philiped">Philip Elmer-DeWitt</a> has <a href="http://tech.fortune.cnn.com/2012/09/29/does-apple-have-a-scott-forstall-problem/">suggested</a> the <a href="http://theamazingios6maps.tumblr.com/">iOS6 Maps debacle</a> falls on the shoulders of <a href="http://en.wikipedia.org/wiki/Scott_Forstall">Scott Forstall</a><sup id="fnref:1"><a class="footnote-ref" href="#fn:1" rel="footnote">1</a></sup>. When I first read the piece, I felt like it was unfair to blame management for this kind of failure. In my experience, the Maps application is wonderful software. The turn-by-turn directions are elegant ...</p></p></div>
        </div>
      </div>
                <div class=entry-overview>
        <div class=date>Oct 01, 2012</div>
        <div class=detail>
          <h1><a href="./2012/10/thoughts-on-grit.html">Thoughts on Grit</a></h1>
            <div class=summary><p><p>I have not had the opportunity to read <a href="http://www.paultough.com/the-books/how-children-succeed/">Paul Tough's newest book</a> on "grit"<sup id="fnref:1"><a class="footnote-ref" href="#fn:1" rel="footnote">2</a></sup>. I have, however, read Paul Tough's <a href="http://www.nytimes.com/2011/09/18/magazine/what-if-the-secret-to-success-is-failure.html">New York Times Magazine article on grit</a> and recently listened to an <a href="http://www.econtalk.org/archives/2012/09/paul_tough_on_h.html">EconTalk podcast</a> where he discussed <span style="text-decoration: underline;">How Children Succeed</span>.</p>
<p>The thrust of Tough's argument, if ...</p></p></div>
        </div>
      </div>
      
<div class="pagination">
<ul>
      <span class="prev disabled"><a href="#">&larr; Previous</a>
        <span class="active"><a href="./index.html">1</a>
      <span class=""><a href="./index2.html">2</a>
      <span class=""><a href="./index3.html">3</a>
      <span class=""><a href="./index4.html">4</a>
      <span class=""><a href="./index5.html">5</a>
        <span class="next"><a href="./index2.html">Next &rarr;</a>
  </ul>
</div>

        </div>
        
                    <div class=footer>
  <p>&copy; Copyright <script language="JavaScript">var date = new Date(); document.write(date.getFullYear());</script> by Jason P. Becker</p>
  <p> Powered by <a href="http://pypi.python.org/pypi/pelican/" target="_blank">Pelican</a>.  
    Theme modified from <a href="https://github.com/fjavieralba/flasky">flasky</a> by <a href="http://fjavieralba.com">fjavieralba</a>
  </p> 
  <p>
    <div class=social style="font-size: 27px;">
      <ul>
        <script language="JavaScript">
          u = 'jason.paul.becker';
          s = 'gmail.com';
          document.write('<a href=\"mailto:' + u + '@' + s + '\" target=\"_blank\">');
        </script>
            <li><i class="icon-envelope icon-large"></i> </li>
        </a>
        <a href="http://twitter.com/jasonpbecker" target="_blank"> <li> <i class="icon-twitter-sign icon-large"> </li></i> </a>
        <a href="http://github.com/jasonpbecker" target="_blank"> <li> <i class="icon-github-sign icon-large"></i> </li> </a>
        <a href="./feeds/all.rss.xml" rel="alternate" title="Recent Blog Posts"><li> <i class="icon-rss icon-large"></i> </li></a>
      </ul>
    </div>
  </p>
</div>            </div>
          </body>
</html>
